<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ChatManager Test</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			max-width: 800px;
			margin: 0 auto;
			padding: 20px;
		}

		.message {
			padding: 10px;
			margin: 10px 0;
			border-radius: 5px;
		}

		.user-message {
			background-color: #e6f7ff;
			margin-left: 20%;
		}

		.assistant-message {
			background-color: #f0f0f0;
			margin-right: 20%;
		}

		.system-message {
			background-color: #fffde7;
			border: 1px solid #ffeb3b;
		}

		.editable-content {
			min-height: 20px;
			padding: 5px;
		}

		.collapsible .editable-content {
			white-space: pre-wrap;
		}

		.message-controls {
			display: flex;
			gap: 5px;
			margin-top: 5px;
		}

		.icon-button {
			background: none;
			border: none;
			cursor: pointer;
			font-size: 16px;
		}

		.collapsed {
			display: none;
		}

		.message-body {
			margin-top: 5px;
		}

		#chat-container {
			border: 1px solid #ccc;
			min-height: 300px;
			margin-bottom: 20px;
			padding: 10px;
			overflow-y: auto;
		}

		#test-actions {
			display: flex;
			flex-direction: column;
			gap: 10px;
			margin-bottom: 20px;
		}

		.action-group {
			display: flex;
			gap: 10px;
			align-items: center;
		}

		#status-bar {
			padding: 10px;
			margin-top: 10px;
			border-radius: 5px;
			display: none;
		}

		.success {
			background-color: #d4edda;
			color: #155724;
		}

		.error {
			background-color: #f8d7da;
			color: #721c24;
		}

		.info {
			background-color: #d1ecf1;
			color: #0c5460;
		}

		.warning {
			background-color: #fff3cd;
			color: #856404;
		}
	</style>
</head>

<body>
	<h1>ChatManager Test</h1>

	<div id="status-bar"></div>

	<div id="test-actions">
		<div class="action-group">
			<h3>System Prompt</h3>
			<input type="text" id="system-prompt-input" placeholder="Enter system prompt"
				value="You are a helpful assistant.">
			<button id="update-system-prompt">Update System Prompt</button>
			<button id="get-system-prompt">Get System Prompt</button>
		</div>

		<div class="action-group">
			<h3>Add Messages</h3>
			<select id="message-role">
				<option value="user">User</option>
				<option value="assistant">Assistant</option>
				<option value="system">System (should fail)</option>
			</select>
			<input type="text" id="message-content" placeholder="Enter message content">
			<button id="add-message">Add Message</button>
		</div>

		<div class="action-group">
			<h3>JSON Operations</h3>
			<button id="get-json">Get Messages JSON</button>
			<button id="parse-json">Parse Test JSON</button>
		</div>

		<div class="action-group">
			<h3>Render</h3>
			<button id="render-messages">Re-render Messages</button>
		</div>
	</div>

	<h3>Chat Container</h3>
	<div id="chat-container"></div>

	<h3>JSON Output</h3>
	<pre id="json-output" style="border: 1px solid #ccc; padding: 10px; max-height: 200px; overflow-y: auto;"></pre>

	<script>
		/*
		// Constants that would normally be imported or globally available
		const ROLES = {
			USER: 'user',
			ASSISTANT: 'assistant',
			SYSTEM: 'system'
		};

		const CSS_CLASSES = {
			MESSAGE: 'message',
			USER_MESSAGE: 'user-message',
			ASSISTANT_MESSAGE: 'assistant-message',
			SYSTEM_MESSAGE: 'system-message',
			EDITABLE_CONTENT: 'editable-content',
			MESSAGE_CONTROLS: 'message-controls',
			COLLAPSIBLE: 'collapsible',
			COLLAPSED: 'collapsed',
			MESSAGE_BODY: 'message-body',
			TOGGLE_COLLAPSE: 'toggle-collapse',
			ICON_BUTTON: 'icon-button'
		};
*/
		// Global showStatus function
		function showStatus(message, type = 'info') {
			const statusBar = document.getElementById('status-bar');
			statusBar.textContent = message;
			statusBar.className = type;
			statusBar.style.display = 'block';

			// Auto-hide after 3 seconds
			setTimeout(() => {
				statusBar.style.display = 'none';
			}, 3000);
		}
	</script>

	<!-- Include ChatMessage component -->
	<script src="../chatmessage.js"></script>

	<!-- Include ChatManager component -->
	<script src="../chatmanager.js"></script>

	<script>
		// Test script for ChatManager
		document.addEventListener('DOMContentLoaded', () => {
			// Get DOM elements
			const chatContainer = document.getElementById('chat-container');
			const systemPromptInput = document.getElementById('system-prompt-input');
			const updateSystemPromptBtn = document.getElementById('update-system-prompt');
			const getSystemPromptBtn = document.getElementById('get-system-prompt');
			const messageRoleSelect = document.getElementById('message-role');
			const messageContentInput = document.getElementById('message-content');
			const addMessageBtn = document.getElementById('add-message');
			const getJsonBtn = document.getElementById('get-json');
			const parseJsonBtn = document.getElementById('parse-json');
			const renderMessagesBtn = document.getElementById('render-messages');
			const jsonOutput = document.getElementById('json-output');

			// Create ChatManager instance
			const chatManager = new ChatManager(
				systemPromptInput.value,
				showStatus,
				chatContainer,
				() => {
					console.log('ChatManager updated');
					// Update JSON output when chat manager updates
					jsonOutput.textContent = JSON.stringify(chatManager.getMessagesJSON(), null, 2);
				}
			);

			// Initial render
			chatManager.render();

			// Update system prompt
			updateSystemPromptBtn.addEventListener('click', () => {
				chatManager.updateSystemPrompt(systemPromptInput.value);
			});

			// Get system prompt
			getSystemPromptBtn.addEventListener('click', () => {
				const systemPrompt = chatManager.getSystemPrompt();
				showStatus(`System prompt: ${systemPrompt}`, 'info');
				systemPromptInput.value = systemPrompt;
			});

			// Add message
			addMessageBtn.addEventListener('click', () => {
				const role = messageRoleSelect.value;
				const content = messageContentInput.value;

				if (!content) {
					showStatus('Message content cannot be empty', 'error');
					return;
				}

				const newMessage = chatManager.addMessage(role, content);
				if (newMessage) {
					messageContentInput.value = '';
					chatManager.render();
				}
			});

			// Get JSON
			getJsonBtn.addEventListener('click', () => {
				const json = chatManager.getMessagesJSON();
				jsonOutput.textContent = JSON.stringify(json, null, 2);
				showStatus('Messages JSON generated', 'success');
			});

			// Parse test JSON
			parseJsonBtn.addEventListener('click', () => {
				const testJson = [
					{ role: 'system', content: 'You are a chatbot for testing.' },
					{ role: 'user', content: 'Hello!' },
					{ role: 'assistant', content: 'Hi there! How can I help you with testing today?' },
					{ role: 'user', content: 'Tell me about ChatManager' }
				];

				chatManager.parseMessagesJSON(testJson);
				chatManager.render();
				jsonOutput.textContent = JSON.stringify(testJson, null, 2);
			});

			// Re-render messages
			renderMessagesBtn.addEventListener('click', () => {
				chatContainer.innerHTML = '';
				chatManager.render();
				showStatus('Messages re-rendered', 'info');
			});

			// Initial JSON output
			jsonOutput.textContent = JSON.stringify(chatManager.getMessagesJSON(), null, 2);
		});
	</script>
</body>

</html>